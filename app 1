# app.py
import streamlit as st
import pandas as pd
import plotly.express as px

# T铆tulo de la Aplicaci贸n
st.title(" An谩lisis Predictivo de Recursos Humanos para Fastenal")

# Subir Archivo Excel
st.header("Subir Datos de Empleados")
uploaded_file = st.file_uploader("Sube tu archivo Excel con los datos de empleados", type=["xlsx"])

if uploaded_file:
    # Leer el archivo subido
    data = pd.read_excel(uploaded_file)
    st.success("Datos cargados exitosamente")
    st.write("Vista previa de los datos:")
    st.dataframe(data.head())

    # C谩lculo del Modelo de Rotaci贸n
    st.subheader(" Modelo de An谩lisis de Rotaci贸n")
    data['Riesgo de Rotaci贸n'] = data.apply(
        lambda row: 1 if row['Satisfacci贸n (%)'] < 65 or row['Horas Extra (mensual)'] > 9 or row['Reconocimientos (anual)'] <= 1 else 0,
        axis=1
    )

    # C谩lculo del Modelo de Compromiso
    st.subheader(" Modelo de Predicci贸n de Compromiso")
    data['Nivel de Compromiso'] = data.apply(
        lambda row: (row['Encuesta Clima (1-5)'] + (0.5 if row['Participaci贸n en Actividades'] == 1 else 0) + 
                     (0.3 * row['Capacitaciones Completadas'])) / 2,
        axis=1
    )

    # C谩lculo del Modelo de Desempe帽o
    st.subheader(" Modelo de Predicci贸n de Desempe帽o")
    data['Predicci贸n de Desempe帽o'] = data.apply(
        lambda row: (row['Desempe帽o (1-5)'] + (0.2 * row['Capacitaciones Completadas']) + 
                     (0.1 * row['Reconocimientos (anual)'])) / 2,
        axis=1
    )

    # Mostrar Resultados
    st.write("Resultados del An谩lisis Predictivo:")
    st.dataframe(data[['ID Empleado', 'Nombre', 'Riesgo de Rotaci贸n', 'Nivel de Compromiso', 'Predicci贸n de Desempe帽o']])

    # Visualizaci贸n de Gr谩ficos
    st.subheader(" Visualizaci贸n de Resultados")
    st.write("Distribuci贸n de Riesgo de Rotaci贸n:")
    fig_rotacion = px.histogram(data, x="Riesgo de Rotaci贸n", title="Distribuci贸n de Riesgo de Rotaci贸n", labels={"x": "Riesgo de Rotaci贸n"})
    st.plotly_chart(fig_rotacion)

    st.write("Nivel de Compromiso Promedio por Departamento (Simulado):")
    if 'Departamento' in data.columns:
        fig_compromiso = px.bar(data, x='Departamento', y='Nivel de Compromiso', title="Nivel de Compromiso por Departamento", labels={"x": "Departamento", "y": "Nivel de Compromiso"})
        st.plotly_chart(fig_compromiso)
    else:
        st.info("Agrega una columna 'Departamento' para mostrar este gr谩fico.")

    st.write("Predicci贸n de Desempe帽o Promedio:")
    fig_desempeno = px.box(data, y="Predicci贸n de Desempe帽o", title="Distribuci贸n de Predicci贸n de Desempe帽o")
    st.plotly_chart(fig_desempeno)

    # Exportar Resultados
    st.subheader(" Exportar Resultados")
    st.download_button(
        label="Descargar Resultados en Excel",
        data=data.to_excel(index=False).encode('utf-8'),
        file_name="resultados_predictivos.xlsx",
        mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    )

